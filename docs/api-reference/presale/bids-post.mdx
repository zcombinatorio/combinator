---
title: "Record Presale Contribution"
description: "POST /presale/:tokenAddress/bids - Record and verify a presale contribution transaction"
---

## Overview

Records a presale contribution after verifying the transaction on-chain. This endpoint validates that $ZC tokens were transferred to the presale escrow, prevents duplicate transactions, and stores the verified contribution for allocation calculations.

<CodeGroup>

```bash curl
curl -X POST https://api.zcombinator.io/presale/EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v/bids \
  -H "Content-Type: application/json" \
  -d '{
    "transactionSignature": "5VfYiDvQMBSWxKJLa9NLPQ1x3...",
    "walletAddress": "9WzDXwBbmkg8ZTbNMqUxvQRAyrZzDsGYdLVL9zYtAWWM",
    "amountTokens": 10000000000,
    "tokenMint": "GVvPZpC6ymCoiHzYJ7CWZ8LhVn9tL2AUpRjSAsLh6jZC"
  }'
```

```javascript fetch
const response = await fetch(
  'https://api.zcombinator.io/presale/EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v/bids',
  {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      transactionSignature: "5VfYiDvQMBSWxKJLa9NLPQ1x3...",
      walletAddress: "9WzDXwBbmkg8ZTbNMqUxvQRAyrZzDsGYdLVL9zYtAWWM",
      amountTokens: 10000000000,
      tokenMint: "GVvPZpC6ymCoiHzYJ7CWZ8LhVn9tL2AUpRjSAsLh6jZC"
    })
  }
);

const result = await response.json();
```

```python requests
import requests

data = {
    "transactionSignature": "5VfYiDvQMBSWxKJLa9NLPQ1x3...",
    "walletAddress": "9WzDXwBbmkg8ZTbNMqUxvQRAyrZzDsGYdLVL9zYtAWWM",
    "amountTokens": 10000000000,
    "tokenMint": "GVvPZpC6ymCoiHzYJ7CWZ8LhVn9tL2AUpRjSAsLh6jZC"
}

response = requests.post(
    'https://api.zcombinator.io/presale/EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v/bids',
    json=data,
    headers={'Content-Type': 'application/json'}
)

result = response.json()
```

</CodeGroup>

## URL Parameters

<ParamField path="tokenAddress" type="string" required>
  The Solana token mint address of the presale
</ParamField>

## Request Parameters

<ParamField body="transactionSignature" type="string" required>
  Solana transaction signature of the $ZC token transfer to the escrow
</ParamField>

<ParamField body="walletAddress" type="string" required>
  Base58 encoded public key of the contributor's wallet
</ParamField>

<ParamField body="amountTokens" type="number" required>
  Amount of $ZC tokens transferred (in smallest units with 6 decimals)
</ParamField>

<ParamField body="tokenMint" type="string" required>
  Token mint address (must be $ZC: `GVvPZpC6ymCoiHzYJ7CWZ8LhVn9tL2AUpRjSAsLh6jZC`)
</ParamField>

## Response

<ResponseField name="success" type="boolean">
  Indicates if the operation was successful
</ResponseField>

<ResponseField name="bid" type="object">
  Recorded bid information containing:
  - `transactionSignature` (string): The verified transaction signature
  - `amountZC` (number): Contribution amount in $ZC tokens (decimal format)
</ResponseField>

<ResponseField name="verification" type="object">
  On-chain verification details:
  - `blockTime` (number): Unix timestamp of the block containing the transaction
  - `slot` (number): Solana slot number where transaction was confirmed
  - `verified` (boolean): Indicates transaction was verified on-chain
</ResponseField>

### Success Response

```json
{
  "success": true,
  "bid": {
    "transactionSignature": "5VfYiDvQMBSWxKJLa9NLPQ1x3...",
    "amountZC": 10000
  },
  "verification": {
    "blockTime": 1642248400,
    "slot": 123456789,
    "verified": true
  }
}
```

## Error Responses

<AccordionGroup>
  <Accordion title="400 - Missing Parameters">
    ```json
    {
      "error": "Missing required fields"
    }
    ```
  </Accordion>

  <Accordion title="400 - Invalid Token Mint">
    ```json
    {
      "error": "Invalid token mint. Only $ZC tokens are accepted"
    }
    ```

    Only $ZC tokens (GVvPZpC6ymCoiHzYJ7CWZ8LhVn9tL2AUpRjSAsLh6jZC) are accepted for presale contributions.
  </Accordion>

  <Accordion title="400 - Invalid Token Address">
    ```json
    {
      "error": "Invalid token address format"
    }
    ```
  </Accordion>

  <Accordion title="400 - Invalid Wallet Address">
    ```json
    {
      "error": "Invalid wallet address format"
    }
    ```
  </Accordion>

  <Accordion title="400 - Invalid Transaction Signature">
    ```json
    {
      "error": "Invalid transaction signature format"
    }
    ```
  </Accordion>

  <Accordion title="400 - Invalid Amount">
    ```json
    {
      "error": "Invalid amount: must be a positive number of tokens"
    }
    ```

    Amount must be a positive number in smallest units.
  </Accordion>

  <Accordion title="400 - Transaction Already Recorded">
    ```json
    {
      "error": "Transaction already recorded"
    }
    ```

    This transaction signature has already been recorded for this presale.
  </Accordion>

  <Accordion title="400 - Escrow Not Configured">
    ```json
    {
      "error": "Presale escrow not configured"
    }
    ```

    The presale is missing escrow configuration.
  </Accordion>

  <Accordion title="400 - Verification Failed">
    ```json
    {
      "error": "Transaction verification failed: [specific reason]"
    }
    ```

    On-chain verification failed. Possible reasons:
    - Transaction not found
    - Transfer not to escrow account
    - Wrong token mint
    - Amount mismatch
    - Transaction too old (>5 minutes)
  </Accordion>

  <Accordion title="404 - Presale Not Found">
    ```json
    {
      "error": "Presale not found"
    }
    ```
  </Accordion>

  <Accordion title="500 - Server Error">
    ```json
    {
      "error": "Failed to save bid"
    }
    ```

    Or:

    ```json
    {
      "error": "Failed to record bid"
    }
    ```
  </Accordion>
</AccordionGroup>

## Process Flow

This endpoint performs extensive verification:

<Steps>
<Step title="Validate Parameters">
Ensures all required fields are present and correctly formatted
</Step>

<Step title="Validate Token Mint">
Verifies the token mint is $ZC (only $ZC contributions accepted)
</Step>

<Step title="Validate Addresses">
Confirms token address, wallet address, and transaction signature are valid
</Step>

<Step title="Validate Amount">
Ensures amount is a positive number
</Step>

<Step title="Acquire Lock">
Obtains transaction-specific lock to prevent concurrent processing
</Step>

<Step title="Fetch Presale">
Retrieves presale data and verifies escrow is configured
</Step>

<Step title="Check for Duplicate">
Checks if this transaction signature was already recorded
</Step>

<Step title="Verify On-Chain">
Critical step: Verifies the transaction on Solana blockchain:
- Transaction exists and is confirmed
- Transfer is from contributor to escrow
- Token is $ZC
- Amount matches
- Transaction is recent (≤5 minutes old)
</Step>

<Step title="Double-Check Duplicate">
Re-checks for duplicate after verification to prevent race conditions
</Step>

<Step title="Record Bid">
Stores verified contribution with transaction details
</Step>

<Step title="Return Confirmation">
Returns success with bid and verification details
</Step>
</Steps>

## On-Chain Verification

<Warning>
**Strict Verification**: Every contribution is verified on-chain before being recorded. The API fetches the transaction from Solana and validates all transfer details.
</Warning>

### Verification Criteria
- ✅ Transaction exists on-chain
- ✅ Transaction is confirmed (not pending)
- ✅ Transfer is from contributor's wallet
- ✅ Transfer is to presale escrow account
- ✅ Token mint is $ZC
- ✅ Amount matches exactly
- ✅ Transaction is recent (maximum 5 minutes old)

## Duplicate Prevention

The endpoint prevents duplicate recordings:

### Multi-Layer Protection
1. **Pre-verification check**: Fast database lookup
2. **Transaction lock**: Prevents concurrent processing
3. **Post-verification check**: Prevents race conditions
4. **Unique constraint**: Database ensures uniqueness

<Info>
**Idempotent**: Submitting the same transaction multiple times will return an error after the first successful recording, ensuring no double-counting.
</Info>

## Token Requirements

<Warning>
**$ZC Tokens Only**: Presale contributions must be made in $ZC tokens. The token mint address is `GVvPZpC6ymCoiHzYJ7CWZ8LhVn9tL2AUpRjSAsLh6jZC`.
</Warning>

### Amount Format
- **Decimals**: $ZC has 6 decimals
- **Smallest Units**: `amountTokens` should be in smallest units
- **Example**: 10,000 $ZC = 10000000000 smallest units

## Transaction Age Limit

<Warning>
**5 Minute Maximum**: Transactions older than 5 minutes (300 seconds) will be rejected. Record contributions promptly after sending the transaction.
</Warning>

## Integration Example

```javascript
import { Token, TOKEN_PROGRAM_ID } from '@solana/spl-token';
import { Connection, PublicKey } from '@solana/web3.js';

// 1. User sends $ZC tokens to escrow
const ZC_MINT = new PublicKey("GVvPZpC6ymCoiHzYJ7CWZ8LhVn9tL2AUpRjSAsLh6jZC");
const escrowPubkey = new PublicKey(presale.escrow_pub_key);

// Transfer $ZC to escrow (user implements this)
const signature = await transferTokens(
  connection,
  wallet,
  ZC_MINT,
  escrowPubkey,
  amount // in smallest units
);

// 2. Wait for confirmation
await connection.confirmTransaction(signature);

// 3. Record the contribution
const response = await fetch(`/presale/${tokenAddress}/bids`, {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    transactionSignature: signature,
    walletAddress: wallet.publicKey.toString(),
    amountTokens: amount, // smallest units
    tokenMint: ZC_MINT.toString()
  })
});

const result = await response.json();

if (result.success) {
  console.log(`Contribution recorded: ${result.bid.amountZC} $ZC`);
}
```

## Error Handling

<Tip>
**Retry on Network Errors**: If verification fails due to network issues, you can retry the same request. Duplicate checking prevents double-recording.
</Tip>

<Tip>
**Transaction Age**: If a user waits too long after sending their transaction, it may be rejected as too old. Prompt users to record contributions immediately.
</Tip>

## Next Steps

After successfully recording a contribution:

1. **Confirm to User**: Show success message with contribution amount
2. **Provide Proof**: Link to transaction on Solana Explorer
3. **Update UI**: Refresh contribution list with new total
4. **Track Allocation**: User's allocation will be calculated when presale launches

## Related Endpoints

- **View Contributions**: Use [`/presale/:tokenAddress/bids`](/api-reference/presale/bids-get) (GET) to see all contributions
- **Check Stats**: Use [`/presale/:tokenAddress/stats`](/api-reference/presale/stats) for aggregate statistics
